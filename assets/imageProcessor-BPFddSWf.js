(function(){"use strict";self.onmessage=function(C){const{imageBitmap:c,id:D,targetColor:f,tolerance:T,smoothness:B,despill:L,edgeErosion:g}=C.data,a=c.width,l=c.height,b=new OffscreenCanvas(a,l),h=b.getContext("2d");h.drawImage(c,0,0);const A=h.getImageData(0,0,a,l),i=A.data,M=parseInt(f.slice(1,3),16),U=parseInt(f.slice(3,5),16),k=parseInt(f.slice(5,7),16),p=T*4.42,v=Math.max(1,B);for(let e=0;e<i.length;e+=4){const t=i[e],s=i[e+1],r=i[e+2],o=Math.sqrt((t-M)*(t-M)+(s-U)*(s-U)+(r-k)*(r-k));let n=255;o<p?n=0:o<p+v&&(n=(o-p)/v*255),L&&n>0&&f.toLowerCase()==="#00ff00"&&s>t&&s>r&&(i[e+1]=(t+r)/2),i[e+3]=n}if(g>0){const e=g,t=c.width,s=c.height,r=new Uint8Array(t*s);for(let n=0;n<t*s;n++)i[n*4+3]<128&&(r[n]=1);const o=new Uint8Array(t*s);for(let n=0;n<s;n++)for(let d=0;d<t;d++){const m=n*t+d;if(r[m]===1){o[m]=1;continue}let w=!1;for(let u=-e;u<=e;u++){for(let x=-e;x<=e;x++){const y=n+u,I=d+x;if(y>=0&&y<s&&I>=0&&I<t&&r[y*t+I]===1){w=!0;break}}if(w)break}w&&(o[m]=1)}for(let n=0;n<t*s;n++)o[n]===1&&(i[n*4+3]=0)}if(g>0){const e=new Uint8Array(a*l);for(let t=0;t<a*l;t++)e[t]=i[t*4+3];for(let t=1;t<l-1;t++)for(let s=1;s<a-1;s++){const r=(t*a+s)*4;let o=0;o+=e[(t-1)*a+(s-1)],o+=e[(t-1)*a+s],o+=e[(t-1)*a+(s+1)],o+=e[t*a+(s-1)],o+=e[t*a+s],o+=e[t*a+(s+1)],o+=e[(t+1)*a+(s-1)],o+=e[(t+1)*a+s],o+=e[(t+1)*a+(s+1)];const n=o/9;i[r+3]=n}}h.putImageData(A,0,0),b.convertToBlob({type:"image/png"}).then(e=>{const t=new FileReader;t.readAsDataURL(e),t.onloadend=()=>{self.postMessage({id:D,dataUrl:t.result})}})}})();
